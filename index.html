<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no"/>
<title>Ú©Ù„Ø§Ø³ Ù†Ù‡Ù… Ø¬</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
  *{box-sizing:border-box;direction:rtl}
  html,body{
    margin:0;padding:0;height:100%;
    font-family:'Vazirmatn',sans-serif;
    background:#0b1220;overflow:hidden;color:#fff;
    touch-action:pan-x pan-y;
  }
  #map{height:100%;width:100%;filter:brightness(0.85) saturate(1.2)}
  #overlay{position:absolute;top:0;left:0;width:100%;height:100%;
    pointer-events:none;background:radial-gradient(circle at center,rgba(255,255,255,0.05),transparent 80%);
    opacity:0.25;}
  .hud{position:absolute;top:20px;left:50%;transform:translateX(-50%);
    display:flex;gap:12px;z-index:10;}
  .hud-item{background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.1);
    padding:10px 18px;border-radius:16px;backdrop-filter:blur(8px);
    box-shadow:0 2px 10px rgba(0,0,0,0.4);font-size:15px;transition:all .3s ease;}
  .hud-item span{color:#00e6b8;font-weight:bold;font-size:17px;}
  .hud-item:hover{transform:scale(1.05);background:rgba(255,255,255,0.15)}
  .bottom-actions{position:absolute;bottom:24px;left:50%;
    transform:translateX(-50%);display:flex;gap:16px;z-index:10;}
  .floating-btn{background:linear-gradient(135deg,#00e6b8,#0075ff);color:#fff;
    padding:14px 26px;border-radius:40px;font-size:16px;font-weight:600;
    border:none;cursor:pointer;box-shadow:0 6px 25px rgba(0,230,184,0.4);
    transition:all .3s ease;min-width:140px;display:inline-flex;
    align-items:center;justify-content:center;text-decoration:none;}
  .floating-btn:hover{transform:scale(1.05);box-shadow:0 8px 30px rgba(0,230,184,0.6);} 
  .btn-disabled{opacity:0.45;pointer-events:none;filter:grayscale(0.3);} 
  .modal{position:fixed;top:0;left:0;width:100%;height:100%;
    background:rgba(0,0,0,0.6);display:none;align-items:center;
    justify-content:center;z-index:999;}
  .card{background:rgba(15,22,40,0.9);border-radius:20px;padding:30px;text-align:center;
    box-shadow:0 10px 40px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.05);
    backdrop-filter:blur(10px);animation:pop .4s ease;max-width:350px;}
  @keyframes pop{0%{transform:scale(0.7);opacity:0}100%{transform:scale(1);opacity:1}}
  .card h2{margin-bottom:10px;color:#00e6b8}
  .card p{color:#ccc;margin-bottom:20px}
  .card button{background:linear-gradient(135deg,#00e6b8,#0075ff);
    border:none;color:#fff;padding:10px 20px;border-radius:8px;
    font-size:15px;cursor:pointer}
  .card button:hover{opacity:.9}
  .reward-marker {
    width: 24px; height: 24px;
    background: radial-gradient(circle at 50% 30%, #ffd700, #ffaa00);
    border-radius: 50%;
    box-shadow: 0 0 12px #ffd700, 0 0 20px #ffb84d;
    animation: pulseReward 1.8s infinite alternate;
    border: 2px solid #fff;
  }
  @keyframes pulseReward {from{transform:scale(1);}to{transform:scale(1.3);}}
  .user-marker {width:18px;height:18px;background:radial-gradient(circle,#00e6b8 30%,#0075ff 70%);
    border-radius:50%;box-shadow:0 0 15px 6px rgba(0,230,184,0.5);
    animation:pulse 2s infinite alternate;border:2px solid #fff;}
  @keyframes pulse{from{transform: scale(1); box-shadow:0 0 15px 6px rgba(0,230,184,0.5);}
                   to{transform: scale(1.3); box-shadow:0 0 25px 12px rgba(0,230,184,0.8);}}
  /* ØµÙØ­Ù‡ Ù„Ø§Ú¯ÛŒÙ† */
  #loginOverlay{position:fixed;inset:0;background:linear-gradient(180deg,rgba(5,8,15,0.95),rgba(2,3,6,0.98));
    display:flex;align-items:center;justify-content:center;z-index:2000;}
  #loginBox{background:rgba(255,255,255,0.04);padding:28px;border-radius:14px;
    border:1px solid rgba(255,255,255,0.06);width:360px;max-width:92%;
    text-align:center;backdrop-filter:blur(8px);box-shadow:0 8px 40px rgba(0,0,0,0.6)}
  #loginBox h1{margin:0 0 10px;color:#00e6b8;font-size:20px}
  #loginBox p{margin:0 0 18px;color:#cfd8e3}
  .input{width:100%;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);
    background:rgba(0,0,0,0.35);color:#fff;font-size:15px;margin-bottom:12px;outline:none}
  .input:focus{box-shadow:0 6px 18px rgba(0,230,184,0.08);border-color:rgba(0,230,184,0.3)}
  .login-btn{width:100%;padding:12px;border-radius:10px;border:none;
    background:linear-gradient(135deg,#00e6b8,#0075ff);color:#fff;font-weight:700;font-size:15px;cursor:pointer}
  .err{color:#ff7b7b;margin-top:8px;min-height:18px}
</style>
</head>
<body>
<div id="map"></div>
<div id="overlay"></div>

<div class="hud">
  <div class="hud-item">Ø§Ù…ØªÛŒØ§Ø²: <span id="score">0</span>/10</div>
</div>

<div class="bottom-actions">
  <button id="resetBtn" class="floating-btn">Reset</button>
  <a id="withdrawBtn" class="floating-btn btn-disabled" href="#" target="_blank">Withdraw</a>
</div>

<div id="winModal" class="modal">
  <div class="card">
    <h2>ğŸ† ØªØ¨Ø±ÛŒÚ©!</h2>
    <p>ØªÙˆ ØªÙˆÙ†Ø³ØªÛŒ Ù¾Ø§Ø¯Ø§Ø´ Ø±Ùˆ Ø¨Ú¯ÛŒØ±ÛŒ!<br>Ù‡Ø¯ÛŒÙ‡â€ŒØ§Øª Ø¨Ø§Ø² Ø´Ø¯ ğŸ’</p>
    <button id="closeWin">Ø¨Ø§Ø´Ù‡</button>
  </div>
</div>

<div id="loginOverlay">
  <div id="loginBox">
    <h1>Ú©Ù„Ø§Ø³ Ù†Ù‡Ù… Ø¬</h1>
    <p>Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ØŒ Ø±Ù…Ø² Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</p>
    <input id="pwd" class="input" type="password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±" autocomplete="off" />
    <button id="loginBtn" class="login-btn">ÙˆØ±ÙˆØ¯</button>
    <div class="err" id="errMsg"></div>
  </div>
</div>

<script>
const LOGIN_PASSWORD = "Nohom_G890";

const map = L.map('map').setView([32.0,53.0],6);
L.tileLayer(`https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=wtyVynedWDK2q9aMHfGI`,{
  attribution:'&copy; MapTiler & OpenStreetMap'
}).addTo(map);

let rewardMarker, userMarker, userCircle;
let hasReward = JSON.parse(localStorage.getItem("rewardTaken") || "false");
const withdrawBtn=document.getElementById("withdrawBtn");
const scoreEl = document.getElementById("score");

if(localStorage.getItem('zoomLocked') === 'true'){ lockZoomInteractions(); }
if(hasReward){ scoreEl.innerText="10"; withdrawBtn.classList.remove('btn-disabled'); withdrawBtn.href='https://t.me/Whale_Armin'; }

function distance(lat1,lon1,lat2,lon2){
  const R=6371e3; 
  const Ï†1=lat1*Math.PI/180, Ï†2=lat2*Math.PI/180;
  const Î”Ï†=(lat2-lat1)*Math.PI/180, Î”Î»=(lon2-lon1)*Math.PI/180;
  const a=Math.sin(Î”Ï†/2)**2+Math.cos(Ï†1)*Math.cos(Ï†2)*Math.sin(Î”Î»/2)**2;
  return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
}

function getRandomDistanceLatLng(centerLat,centerLng,minM,maxM){
  const R=6371000;
  const d=Math.random()*(maxM-minM)+minM;
  const brng=Math.random()*2*Math.PI;
  const newLat=centerLat + (d/R)*(180/Math.PI)*Math.cos(brng);
  const newLng=centerLng + (d/R)*(180/Math.PI)*Math.sin(brng)/Math.cos(centerLat*Math.PI/180);
  return {lat:newLat,lng:newLng};
}

function createReward(center){
  if(hasReward) return;
  const pos=getRandomDistanceLatLng(center.lat,center.lng,1000,3000);
  rewardMarker=L.marker([pos.lat,pos.lng],{icon:L.divIcon({className:'reward-marker'})});
  rewardMarker.addTo(map);
}

function updateUserLocation(pos){
  const lat=pos.coords.latitude, lng=pos.coords.longitude;
  if(!userMarker){
    userMarker=L.marker([lat,lng],{icon:L.divIcon({className:'user-marker'})}).addTo(map);
    userCircle=L.circle([lat,lng],{radius:50,color:'#00e6b8',fillColor:'#00e6b8',fillOpacity:0.1}).addTo(map);
    map.setView([lat,lng],17);
    createReward({lat,lng});
  } else {
    userMarker.setLatLng([lat,lng]);
    userCircle.setLatLng([lat,lng]);
  }

  if(rewardMarker && !hasReward){
    const dist=distance(lat,lng,rewardMarker.getLatLng().lat,rewardMarker.getLatLng().lng);
    if(dist<50){
      rewardMarker.remove();
      hasReward=true;
      localStorage.setItem("rewardTaken","true");
      localStorage.setItem("zoomLocked","true");
      scoreEl.innerText="10";
      withdrawBtn.classList.remove('btn-disabled');
      withdrawBtn.href='https://t.me/Whale_Armin';
      showModal();
    }
  }
}

function showModal(){
  const modal=document.getElementById("winModal");
  modal.style.display='flex';
  document.getElementById("closeWin").addEventListener('click',()=>modal.style.display='none',{once:true});
}

function lockZoomInteractions(){
  try{
    map.scrollWheelZoom.disable();
    map.touchZoom.disable();
    map.doubleClickZoom.disable();
    map.boxZoom.disable();
    map.keyboard.disable();
    if(map.zoomControl) map.zoomControl.remove();
  }catch(e){}
}

document.getElementById("resetBtn").addEventListener("click",()=>{
  if(userMarker){
    const latlng=userMarker.getLatLng();
    map.setView(latlng,17,{animate:false});
    lockZoomInteractions();
    localStorage.setItem('zoomLocked','true');
  }
});

const overlay=document.getElementById("loginOverlay");
document.getElementById("loginBtn").addEventListener("click",()=>{
  const val=document.getElementById("pwd").value.trim();
  if(val===LOGIN_PASSWORD){
    overlay.style.display="none";
    if(navigator.geolocation){
      navigator.geolocation.getCurrentPosition(pos=>{
        updateUserLocation(pos);
        navigator.geolocation.watchPosition(updateUserLocation,()=>{}, {enableHighAccuracy:true});
      });
    }
  } else {
    document.getElementById("errMsg").innerText="Ø±Ù…Ø² Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª!";
  }
});
document.getElementById("pwd").addEventListener("keydown",e=>{
  if(e.key==="Enter")document.getElementById("loginBtn").click();
});
</script>
</body>
</html>
