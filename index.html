<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ú©Ù„Ø§Ø³ Ù†Ù‡Ù… Ø¬</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
  *{box-sizing:border-box;direction:rtl}
  html,body{margin:0;padding:0;height:100%;font-family:'Vazirmatn',sans-serif;background:#0b1220;overflow:hidden;color:#fff}
  #map{height:100%;width:100%;filter:brightness(0.9) saturate(1.2)}
  #overlay{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;background:radial-gradient(circle at center,rgba(255,255,255,0.05),transparent 80%);opacity:0.25;}
  .hud{position:absolute;top:20px;left:50%;transform:translateX(-50%);display:flex;gap:12px;z-index:10;}
  .hud-item{background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.1);padding:10px 18px;border-radius:16px;backdrop-filter:blur(8px);box-shadow:0 2px 10px rgba(0,0,0,0.4);font-size:15px;}
  .hud-item span{color:#00e6b8;font-weight:bold;font-size:17px;}
  .bottom-actions{position:absolute;bottom:24px;left:50%;transform:translateX(-50%);display:flex;gap:16px;z-index:10;}
  .floating-btn{background:linear-gradient(135deg,#00e6b8,#0075ff);color:#fff;padding:14px 26px;border-radius:40px;font-size:16px;font-weight:600;border:none;cursor:pointer;box-shadow:0 6px 25px rgba(0,230,184,0.4);transition:all .3s ease;}
  .floating-btn:hover{transform:scale(1.05);}
  .btn-disabled{opacity:0.45;pointer-events:none;filter:grayscale(0.3);}
  .reward-marker {
    width: 24px; height: 24px;
    background: radial-gradient(circle at 50% 30%, #ffd700, #ffaa00);
    border-radius: 50%;
    box-shadow: 0 0 12px #ffd700, 0 0 20px #ffb84d;
    animation: pulseReward 1.8s infinite alternate;
    border: 2px solid #fff;
  }
  @keyframes pulseReward {from{transform:scale(1);}to{transform:scale(1.3);}}
  .user-marker {width:18px;height:18px;background:radial-gradient(circle,#00e6b8 30%,#0075ff 70%);border-radius:50%;box-shadow:0 0 15px 6px rgba(0,230,184,0.5);animation:pulse 2s infinite alternate;border:2px solid #fff;}
  @keyframes pulse{from{transform: scale(1);}to{transform: scale(1.3);}}
  #loginScreen{position:fixed;top:0;left:0;width:100%;height:100%;background:#0b1220;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10000;}
  #loginScreen h1{color:#00e6b8;margin-bottom:20px;}
  #loginScreen input{padding:10px 15px;border-radius:8px;border:none;outline:none;font-size:16px;margin-bottom:10px;width:200px;text-align:center;}
  #loginScreen button{background:linear-gradient(135deg,#00e6b8,#0075ff);border:none;padding:10px 20px;border-radius:8px;color:#fff;font-weight:bold;cursor:pointer;}
</style>
</head>
<body>
<div id="loginScreen">
  <h1>ğŸ” ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ú©Ù„Ø§Ø³ Ù†Ù‡Ù… Ø¬</h1>
  <input type="password" id="passwordInput" placeholder="Ø±Ù…Ø² ÙˆØ±ÙˆØ¯">
  <button onclick="checkPassword()">ÙˆØ±ÙˆØ¯</button>
  <p id="errorMsg" style="display:none;color:#ff7070;">Ø±Ù…Ø² Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª!</p>
</div>

<div id="map" style="display:none;"></div>
<div id="overlay" style="display:none;"></div>

<div class="hud" style="display:none;">
  <div class="hud-item">Ù‚ÙÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²Ø´Ø¯Ù‡: <span id="count">0</span>/10</div>
  <div class="hud-item">Ù†Ø´Ø§Ù†Ú¯Ø±Ù‡Ø§: <span id="total">0</span></div>
</div>

<div class="bottom-actions" style="display:none;">
  <button id="resetBtn" class="floating-btn">Reset</button>
  <a id="withdrawBtn" class="floating-btn btn-disabled" href="#" target="_blank">Withdraw</a>
</div>

<script>
function checkPassword(){
  const pass=document.getElementById("passwordInput").value.trim();
  if(pass==="Nohom_G890"){
    document.getElementById("loginScreen").style.display="none";
    document.querySelectorAll("#map,#overlay,.hud,.bottom-actions").forEach(e=>e.style.display="");
    initMap();
  }else document.getElementById("errorMsg").style.display="block";
}

function initMap(){
  const map=L.map('map').setView([32,53],6);
  L.tileLayer(`https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=wtyVynedWDK2q9aMHfGI`).addTo(map);

  let markers=[], unlockedIds=[], userMarker;

  function distance(lat1,lon1,lat2,lon2){
    const R=6371e3;
    const Ï†1=lat1*Math.PI/180, Ï†2=lat2*Math.PI/180;
    const Î”Ï†=(lat2-lat1)*Math.PI/180, Î”Î»=(lon2-lon1)*Math.PI/180;
    const a=Math.sin(Î”Ï†/2)**2+Math.cos(Ï†1)*Math.cos(Ï†2)*Math.sin(Î”Î»/2)**2;
    return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
  }

  // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø®ØªØµØ§Øª Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ø´Ø¹Ø§Ø¹ Ùˆ Ø²Ø§ÙˆÛŒÙ‡
  function computeOffset(lat, lng, distanceMeters, bearingDegrees){
    const R=6371000;
    const Î´=distanceMeters/R;
    const Î¸=bearingDegrees*Math.PI/180;
    const Ï†1=lat*Math.PI/180, Î»1=lng*Math.PI/180;
    const Ï†2=Math.asin(Math.sin(Ï†1)*Math.cos(Î´)+Math.cos(Ï†1)*Math.sin(Î´)*Math.cos(Î¸));
    const Î»2=Î»1+Math.atan2(Math.sin(Î¸)*Math.sin(Î´)*Math.cos(Ï†1), Math.cos(Î´)-Math.sin(Ï†1)*Math.sin(Ï†2));
    return {lat:Ï†2*180/Math.PI, lng:Î»2*180/Math.PI};
  }

  function createRewards(n,center){
    markers.forEach(m=>m.remove?.());
    markers=[];
    const angleStep=360/n;
    for(let i=0;i<n;i++){
      const bearing=i*angleStep + Math.random()*5; // Ø²Ø§ÙˆÛŒÙ‡ Ø¨Ø§ Ú©Ù…ÛŒ ØªØµØ§Ø¯Ù
      const dist=1000 + Math.random()*1000; // Ø¨ÛŒÙ† Û± ØªØ§ Û² Ú©ÛŒÙ„ÙˆÙ…ØªØ±
      const pos=computeOffset(center.lat, center.lng, dist, bearing);
      const id=`${pos.lat.toFixed(5)},${pos.lng.toFixed(5)}`;
      const marker=L.marker([pos.lat,pos.lng],{icon:L.divIcon({className:'reward-marker'})});
      marker.id=id;
      marker.addTo(map);
      markers.push(marker);
    }
    document.getElementById("total").innerText=n;
  }

  function updateUser(pos){
    const lat=pos.coords.latitude, lng=pos.coords.longitude;
    if(!userMarker){
      userMarker=L.marker([lat,lng],{icon:L.divIcon({className:'user-marker'})}).addTo(map);
      map.setView([lat,lng],15);
      createRewards(40,{lat,lng});
    } else userMarker.setLatLng([lat,lng]);

    markers.forEach(marker=>{
      if(!unlockedIds.includes(marker.id)){
        const dist=distance(lat,lng,marker.getLatLng().lat,marker.getLatLng().lng);
        if(dist<50){
          marker.remove();
          unlockedIds.push(marker.id);
          document.getElementById("count").innerText=unlockedIds.length;
        }
      }
    });
  }

  document.getElementById("resetBtn").onclick=()=>{
    if(userMarker)map.setView(userMarker.getLatLng(),15,{animate:true});
  }

  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(p=>{
      updateUser(p);
      navigator.geolocation.watchPosition(updateUser,()=>{}, {enableHighAccuracy:true});
    });
  }
}
</script>
</body>
</html>
